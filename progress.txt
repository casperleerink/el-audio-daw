## 2026-01-27: Audio Engine Auto-Initialization

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Remove explicit "Start Audio" button** - No longer blocks the entire UI
- **Add audio initialization loading state** - Play button shows spinner on first click
- **Handle audio initialization failure gracefully** - Toast error message on failure

### Changes Made
- Modified `apps/web/src/routes/project.$id.tsx`:
  - Removed the blocking "Start Audio" screen that prevented users from seeing their tracks
  - Audio engine now initializes lazily on first play or timeline seek action
  - Added `isEngineInitializing` state to track initialization
  - Play button shows Loader2 spinner and is disabled during initialization
  - Stop button is also disabled during initialization
  - `initializeEngine()` now returns the engine instance for chaining
  - `handlePlay()` is now async and initializes engine if needed
  - `onSeek` handler also initializes engine if needed
  - Error toast displays on initialization failure

### Notes for Next Developer
- The audio engine is now lazy-initialized. Users can view/edit tracks before any audio action.
- The `AudioContext` is created on first user gesture (play/seek) per browser autoplay policy.
- If you add new transport actions (e.g., record), remember to call `initializeEngine()` first.
- The `engineRef.current?.isInitialized()` check prevents double initialization.

## 2026-01-27: Disable Overscroll Globally

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Disable overscroll globally** - Prevent rubber-band/bounce effects that interfere with panning

### Changes Made
- Modified `apps/web/src/index.css`:
  - Added `overscroll-behavior: none` to html and body elements
  - This prevents the rubber-band/bounce effect on macOS/iOS when scrolling past boundaries
- Modified `apps/web/src/routes/project.$id.tsx`:
  - Added `touch-none` Tailwind class to TimelineCanvas container
  - This prevents browser default touch gestures from interfering with timeline panning/zooming

### Notes for Next Developer
- The `overscroll-behavior: none` CSS property is well-supported in modern browsers
- The `touch-action: none` (via Tailwind's `touch-none`) on the timeline prevents mobile browsers from hijacking touch gestures
- If you need custom touch handling in the timeline (pinch-to-zoom), you'll need to implement it with JavaScript touch events

## 2026-01-27: Track Operations Loading States

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Add loading states to track operations** - Show feedback when adding, deleting, reordering tracks

### Changes Made
- Modified `apps/web/src/routes/project.$id.tsx`:
  - Added `isAddingTrack` state to track when a track is being created
  - Added `deletingTrackId` state to track which track is being deleted
  - `handleAddTrack()` now sets loading state and shows spinner on Add Track button
  - `handleDeleteTrack()` now sets loading state for the specific track being deleted
  - Add Track button shows Loader2 spinner and is disabled during creation
  - Delete button shows Loader2 spinner and is disabled during deletion
  - Added `deletingTrackId` prop to VirtualizedTrackList and `isDeleting` prop to TrackHeader

### Notes for Next Developer
- The loading states are per-operation: adding a track disables only the Add Track button, deleting a track disables only that track's delete button
- Reorder operations already have visual feedback via the drop indicator lines - no additional loading state was needed
- The PRD also noted "Add loading spinner to project creation button" as incomplete, but it was already implemented in `apps/web/src/routes/index.tsx` - marked as complete

## 2026-01-27: Project Loading Skeleton

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Add loading overlay during project load** - Show skeleton while project data loads

### Changes Made
- Modified `apps/web/src/routes/project.$id.tsx`:
  - Added import for `Skeleton` component from `@/components/ui/skeleton`
  - Created new `ProjectEditorSkeleton` component that mirrors the editor layout structure
  - Skeleton includes: header (back button, project name, settings), transport controls (play/stop, time, add track), track list with 3 placeholder tracks, master track controls, and timeline with ruler
  - Replaced the simple centered `Loader2` spinner with the full skeleton layout
  - Loading state now shows the skeleton until both `project` and `tracks` queries resolve

### Notes for Next Developer
- The skeleton component is intentionally simple - it shows 3 placeholder track rows which works for most use cases
- The skeleton uses the existing `Skeleton` component from `@/components/ui/skeleton` which has `animate-pulse` built in
- If the editor layout changes significantly, remember to update the skeleton to match
- The skeleton renders immediately while Convex queries are undefined, providing instant visual feedback

## 2026-01-27: Track Mute/Solo/Gain Optimistic Updates

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Add optimistic updates for track mute/solo/gain** - Instant UI feedback before server confirms

### Changes Made
- Modified `apps/web/src/routes/project.$id.tsx`:
  - Added `optimisticUpdates` state (Map of trackId -> { muted?, solo?, gain? })
  - Created `tracksWithOptimisticUpdates` memo that merges server data with optimistic values
  - Added `applyOptimisticUpdate()` helper to set optimistic values instantly
  - Added `clearOptimisticUpdate()` helper to remove optimistic values after mutation completes/fails
  - Updated `handleUpdateTrackMute/Solo/Gain` handlers to:
    1. Apply optimistic update immediately (before await)
    2. Call Convex mutation
    3. Clear optimistic update on success (server data will be authoritative)
    4. Roll back optimistic update on failure + show error toast
  - Updated audio engine sync to use `tracksWithOptimisticUpdates` for instant audio feedback
  - Updated VirtualizedTrackList to receive `tracksWithOptimisticUpdates`

### Notes for Next Developer
- Optimistic updates are stored separately from server data to enable clean rollback
- The merge happens in `tracksWithOptimisticUpdates` memo - optimistic values override server values
- On mutation success, we clear the optimistic value because Convex will sync the new server value
- On mutation failure, we clear the optimistic value to rollback to previous server state
- The audio engine also uses optimistic data, so mute/solo/gain changes are heard instantly
- Gain slider sends many updates rapidly - each is optimistically applied, preventing lag

## 2026-01-27: Prevent Browser Zoom on Timeline Pinch Gesture

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Prevent browser zoom on timeline pinch gesture** - Block default browser zoom when using trackpad pinch in timeline

### Changes Made
- Modified `apps/web/src/routes/project.$id.tsx`:
  - Added `GestureEvent` interface declaration for Safari-specific gesture events
  - Added `useEffect` in `TimelineCanvas` component to handle Safari trackpad pinch gestures
  - Listens for `gesturestart`, `gesturechange`, `gestureend` events on the timeline container
  - All gesture events call `e.preventDefault()` to block browser zoom
  - `gesturechange` handler calculates zoom factor from gesture scale and applies to `pixelsPerSecond`
  - Properly cleans up event listeners on unmount

### Notes for Next Developer
- The existing `handleWheel` with `e.preventDefault()` handles Chrome/Firefox wheel events with ctrlKey/metaKey
- Safari fires separate gesture events for trackpad pinch-to-zoom instead of wheel events
- `GestureEvent` is Safari-specific and not in standard DOM types, hence the local interface declaration
- The `touch-none` CSS class (already present) handles touch events on mobile/tablet
- Combined approach ensures cross-browser compatibility: wheel events (Chrome, Firefox) + gesture events (Safari)

## 2026-01-27: Auth Form Submit Button Loading States

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Disable auth form submit buttons during submission** - Prevent double-submit on sign-in/sign-up

### Changes Made
- Modified `apps/web/src/components/sign-in-form.tsx`:
  - Added Loader2 import from lucide-react
  - Updated submit button to show spinner icon + "Signing in..." text during submission
  - Button remains disabled via `!state.canSubmit || state.isSubmitting` (already existed)
- Modified `apps/web/src/components/sign-up-form.tsx`:
  - Added Loader2 import from lucide-react
  - Updated submit button to show spinner icon + "Signing up..." text during submission
  - Button remains disabled via `!state.canSubmit || state.isSubmitting` (already existed)

### Notes for Next Developer
- The forms already had `disabled` logic using TanStack React Form's `state.isSubmitting`
- The change adds visual spinner feedback alongside the text change for better UX
- Pattern matches other loading states in the app (e.g., Add Track button, Delete button)

## 2026-01-27: Auth Form Error Display

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Add form-level error display for auth forms** - Show auth errors prominently above form

### Changes Made
- Modified `apps/web/src/components/sign-in-form.tsx`:
  - Added `formError` state to track server-side auth errors
  - Added AlertCircle import from lucide-react
  - Display error message in styled alert box above form fields when auth fails
  - Error shows with red background, border, and AlertCircle icon
  - Supports dark mode styling
  - Clear error when user starts typing in any field
  - Error is shown in addition to toast (for redundancy and visibility)
- Modified `apps/web/src/components/sign-up-form.tsx`:
  - Same changes as sign-in form
  - All three fields (name, email, password) clear error on change

### Notes for Next Developer
- The form-level error complements the toast notification - users see the error prominently in the form AND in the toast
- Error clears on any field change so users know they can retry
- Error state is set in `onError` callback and cleared in `onSubmit` start and on field change
- Styling uses Tailwind with dark mode support (dark:border-red-900 dark:bg-red-950 dark:text-red-400)
- Field-level validation errors (email format, password length) still appear inline under each field
