## 2026-01-27: Audio Engine Auto-Initialization

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Remove explicit "Start Audio" button** - No longer blocks the entire UI
- **Add audio initialization loading state** - Play button shows spinner on first click
- **Handle audio initialization failure gracefully** - Toast error message on failure

### Changes Made
- Modified `apps/web/src/routes/project.$id.tsx`:
  - Removed the blocking "Start Audio" screen that prevented users from seeing their tracks
  - Audio engine now initializes lazily on first play or timeline seek action
  - Added `isEngineInitializing` state to track initialization
  - Play button shows Loader2 spinner and is disabled during initialization
  - Stop button is also disabled during initialization
  - `initializeEngine()` now returns the engine instance for chaining
  - `handlePlay()` is now async and initializes engine if needed
  - `onSeek` handler also initializes engine if needed
  - Error toast displays on initialization failure

### Notes for Next Developer
- The audio engine is now lazy-initialized. Users can view/edit tracks before any audio action.
- The `AudioContext` is created on first user gesture (play/seek) per browser autoplay policy.
- If you add new transport actions (e.g., record), remember to call `initializeEngine()` first.
- The `engineRef.current?.isInitialized()` check prevents double initialization.

## 2026-01-27: Disable Overscroll Globally

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Disable overscroll globally** - Prevent rubber-band/bounce effects that interfere with panning

### Changes Made
- Modified `apps/web/src/index.css`:
  - Added `overscroll-behavior: none` to html and body elements
  - This prevents the rubber-band/bounce effect on macOS/iOS when scrolling past boundaries
- Modified `apps/web/src/routes/project.$id.tsx`:
  - Added `touch-none` Tailwind class to TimelineCanvas container
  - This prevents browser default touch gestures from interfering with timeline panning/zooming

### Notes for Next Developer
- The `overscroll-behavior: none` CSS property is well-supported in modern browsers
- The `touch-action: none` (via Tailwind's `touch-none`) on the timeline prevents mobile browsers from hijacking touch gestures
- If you need custom touch handling in the timeline (pinch-to-zoom), you'll need to implement it with JavaScript touch events

## 2026-01-27: Track Operations Loading States

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Add loading states to track operations** - Show feedback when adding, deleting, reordering tracks

### Changes Made
- Modified `apps/web/src/routes/project.$id.tsx`:
  - Added `isAddingTrack` state to track when a track is being created
  - Added `deletingTrackId` state to track which track is being deleted
  - `handleAddTrack()` now sets loading state and shows spinner on Add Track button
  - `handleDeleteTrack()` now sets loading state for the specific track being deleted
  - Add Track button shows Loader2 spinner and is disabled during creation
  - Delete button shows Loader2 spinner and is disabled during deletion
  - Added `deletingTrackId` prop to VirtualizedTrackList and `isDeleting` prop to TrackHeader

### Notes for Next Developer
- The loading states are per-operation: adding a track disables only the Add Track button, deleting a track disables only that track's delete button
- Reorder operations already have visual feedback via the drop indicator lines - no additional loading state was needed
- The PRD also noted "Add loading spinner to project creation button" as incomplete, but it was already implemented in `apps/web/src/routes/index.tsx` - marked as complete

## 2026-01-27: Project Loading Skeleton

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Add loading overlay during project load** - Show skeleton while project data loads

### Changes Made
- Modified `apps/web/src/routes/project.$id.tsx`:
  - Added import for `Skeleton` component from `@/components/ui/skeleton`
  - Created new `ProjectEditorSkeleton` component that mirrors the editor layout structure
  - Skeleton includes: header (back button, project name, settings), transport controls (play/stop, time, add track), track list with 3 placeholder tracks, master track controls, and timeline with ruler
  - Replaced the simple centered `Loader2` spinner with the full skeleton layout
  - Loading state now shows the skeleton until both `project` and `tracks` queries resolve

### Notes for Next Developer
- The skeleton component is intentionally simple - it shows 3 placeholder track rows which works for most use cases
- The skeleton uses the existing `Skeleton` component from `@/components/ui/skeleton` which has `animate-pulse` built in
- If the editor layout changes significantly, remember to update the skeleton to match
- The skeleton renders immediately while Convex queries are undefined, providing instant visual feedback

## 2026-01-27: Track Mute/Solo/Gain Optimistic Updates

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Add optimistic updates for track mute/solo/gain** - Instant UI feedback before server confirms

### Changes Made
- Modified `apps/web/src/routes/project.$id.tsx`:
  - Added `optimisticUpdates` state (Map of trackId -> { muted?, solo?, gain? })
  - Created `tracksWithOptimisticUpdates` memo that merges server data with optimistic values
  - Added `applyOptimisticUpdate()` helper to set optimistic values instantly
  - Added `clearOptimisticUpdate()` helper to remove optimistic values after mutation completes/fails
  - Updated `handleUpdateTrackMute/Solo/Gain` handlers to:
    1. Apply optimistic update immediately (before await)
    2. Call Convex mutation
    3. Clear optimistic update on success (server data will be authoritative)
    4. Roll back optimistic update on failure + show error toast
  - Updated audio engine sync to use `tracksWithOptimisticUpdates` for instant audio feedback
  - Updated VirtualizedTrackList to receive `tracksWithOptimisticUpdates`

### Notes for Next Developer
- Optimistic updates are stored separately from server data to enable clean rollback
- The merge happens in `tracksWithOptimisticUpdates` memo - optimistic values override server values
- On mutation success, we clear the optimistic value because Convex will sync the new server value
- On mutation failure, we clear the optimistic value to rollback to previous server state
- The audio engine also uses optimistic data, so mute/solo/gain changes are heard instantly
- Gain slider sends many updates rapidly - each is optimistically applied, preventing lag

## 2026-01-27: Prevent Browser Zoom on Timeline Pinch Gesture

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Prevent browser zoom on timeline pinch gesture** - Block default browser zoom when using trackpad pinch in timeline

### Changes Made
- Modified `apps/web/src/routes/project.$id.tsx`:
  - Added `GestureEvent` interface declaration for Safari-specific gesture events
  - Added `useEffect` in `TimelineCanvas` component to handle Safari trackpad pinch gestures
  - Listens for `gesturestart`, `gesturechange`, `gestureend` events on the timeline container
  - All gesture events call `e.preventDefault()` to block browser zoom
  - `gesturechange` handler calculates zoom factor from gesture scale and applies to `pixelsPerSecond`
  - Properly cleans up event listeners on unmount

### Notes for Next Developer
- The existing `handleWheel` with `e.preventDefault()` handles Chrome/Firefox wheel events with ctrlKey/metaKey
- Safari fires separate gesture events for trackpad pinch-to-zoom instead of wheel events
- `GestureEvent` is Safari-specific and not in standard DOM types, hence the local interface declaration
- The `touch-none` CSS class (already present) handles touch events on mobile/tablet
- Combined approach ensures cross-browser compatibility: wheel events (Chrome, Firefox) + gesture events (Safari)

## 2026-01-27: Auth Form Submit Button Loading States

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Disable auth form submit buttons during submission** - Prevent double-submit on sign-in/sign-up

### Changes Made
- Modified `apps/web/src/components/sign-in-form.tsx`:
  - Added Loader2 import from lucide-react
  - Updated submit button to show spinner icon + "Signing in..." text during submission
  - Button remains disabled via `!state.canSubmit || state.isSubmitting` (already existed)
- Modified `apps/web/src/components/sign-up-form.tsx`:
  - Added Loader2 import from lucide-react
  - Updated submit button to show spinner icon + "Signing up..." text during submission
  - Button remains disabled via `!state.canSubmit || state.isSubmitting` (already existed)

### Notes for Next Developer
- The forms already had `disabled` logic using TanStack React Form's `state.isSubmitting`
- The change adds visual spinner feedback alongside the text change for better UX
- Pattern matches other loading states in the app (e.g., Add Track button, Delete button)

## 2026-01-27: Auth Form Error Display

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Add form-level error display for auth forms** - Show auth errors prominently above form

### Changes Made
- Modified `apps/web/src/components/sign-in-form.tsx`:
  - Added `formError` state to track server-side auth errors
  - Added AlertCircle import from lucide-react
  - Display error message in styled alert box above form fields when auth fails
  - Error shows with red background, border, and AlertCircle icon
  - Supports dark mode styling
  - Clear error when user starts typing in any field
  - Error is shown in addition to toast (for redundancy and visibility)
- Modified `apps/web/src/components/sign-up-form.tsx`:
  - Same changes as sign-in form
  - All three fields (name, email, password) clear error on change

### Notes for Next Developer
- The form-level error complements the toast notification - users see the error prominently in the form AND in the toast
- Error clears on any field change so users know they can retry
- Error state is set in `onError` callback and cleared in `onSubmit` start and on field change
- Styling uses Tailwind with dark mode support (dark:border-red-900 dark:bg-red-950 dark:text-red-400)
- Field-level validation errors (email format, password length) still appear inline under each field

## 2026-01-27: Project Name Saving Indicator

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Show saving indicator for project name changes** - Indicate when project name is being saved

### Changes Made
- Modified `apps/web/src/routes/project.$id.tsx`:
  - Added `isSavingProjectName` state to track when project name mutation is in flight
  - Updated `handleSaveProjectName()` to set loading state before mutation and clear it in finally block
  - Updated Save button in settings dialog to show Loader2 spinner and "Saving..." text during mutation
  - Save button is disabled while saving to prevent double-submit

### Notes for Next Developer
- Pattern matches other loading states in the app (Add Track, Delete Track, Auth forms)
- The button shows "Saving..." with spinner when active, plain "Save" when idle
- Loading state is cleared in `finally` block to ensure it clears on both success and error
- Dialog closes on success but stays open on error so user can retry

## 2026-01-27: Keyboard Shortcut Hints in Tooltips

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Add keyboard shortcut hints** - Show shortcut hints in tooltips

### Changes Made
- Modified `apps/web/src/components/ui/tooltip.tsx`:
  - Added `delay` prop to `Tooltip` component to support configurable hover delay
  - Default delay remains 0 for backwards compatibility
- Modified `apps/web/src/routes/project.$id.tsx`:
  - Added imports for `Tooltip`, `TooltipTrigger`, `TooltipContent`, and `Kbd` components
  - Wrapped Play/Pause button with tooltip showing "Play/Pause" + `Space` keyboard hint
  - Wrapped Stop button with tooltip showing "Stop"
  - Wrapped Add Track button with tooltip showing "Add Track" + `âŒ˜T` keyboard hint
  - All tooltips use 500ms delay per FR-7 requirement

### Notes for Next Developer
- The `Tooltip` component now accepts a `delay` prop (in milliseconds) for hover delay
- Kbd component already has special styling for use inside tooltips (`in-data-[slot=tooltip-content]:`)
- The Play button tooltip content dynamically changes based on `isPlaying` state
- Base UI's `TooltipTrigger` uses `render` prop pattern to compose with existing Button components
- If adding more transport actions, wrap them with tooltips following the same pattern

## 2026-01-27: Empty State for New Projects

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Improve empty state for new projects** - Better messaging when no tracks exist

### Changes Made
- Modified `apps/web/src/routes/project.$id.tsx`:
  - Added `onAddTrack` and `isAddingTrack` props to `VirtualizedTrackListProps` interface
  - Updated `VirtualizedTrackList` component to accept and use these new props
  - Enhanced the empty state (when `tracks.length === 0`) to show a centered layout with:
    - "No tracks yet" message
    - Prominent "Add Track" button with Plus icon
    - Loading spinner on button during track creation
  - Passed `handleAddTrack` and `isAddingTrack` from parent `ProjectEditor` component

### Notes for Next Developer
- The empty state button reuses the same `handleAddTrack` callback as the transport controls
- Loading state (`isAddingTrack`) is shared between the header button and empty state button
- The empty state uses flexbox centering to position content in the track list area
- If you change the Add Track flow, both buttons will automatically inherit the change

## 2026-01-27: Inline Track Name Editing Improvements

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Improve inline track name editing** - Better visual affordance for editable names

### Changes Made
- Modified `apps/web/src/routes/project.$id.tsx`:
  - Added `Pencil` icon import from lucide-react
  - Updated track name display button to show subtle pencil icon on hover
  - Icon uses `opacity-0 group-hover:opacity-100` transition for smooth reveal
  - Icon is styled with `text-muted-foreground` for subtle appearance
  - Track name text wrapped in `<span>` with `truncate` to preserve ellipsis behavior
  - Edit mode input now has visible ring styling (`ring-1 ring-ring/50 border-ring`) for clearer focus state
  - Escape key already cancels edit (was already implemented)

### Notes for Next Developer
- The hover icon uses Tailwind's `group` pattern for parent-child hover state
- The icon is `size-2.5` to be subtle and not compete with the track name
- `shrink-0` on the icon prevents it from being truncated when track name is long
- The edit input border/ring styling makes it very clear when you're in edit mode
- The smooth opacity transition (`transition-opacity`) makes the icon appear/disappear gracefully

## 2026-01-27: Success Toasts for Track Operations

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Add toast for successful actions** - Confirm track add/delete completed

### Changes Made
- Modified `apps/web/src/routes/project.$id.tsx`:
  - Added `toast.success("Track added")` after successful track creation in `handleAddTrack()`
  - Added `toast.success("Track deleted")` after successful track deletion in `handleDeleteTrack()`

### Notes for Next Developer
- Success toasts use Sonner's `toast.success()` which displays a brief green-tinted notification
- Error toasts were already implemented for failure cases - now both success and failure have feedback
- Pattern is consistent with `toast.success("Project renamed")` already in `handleSaveProjectName()`
- These toasts are intentionally brief to avoid interrupting workflow

## 2026-01-27: Character Limit Feedback for Inputs

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Add character limit feedback for inputs** - Show remaining characters for project/track names

### Changes Made
- Modified `apps/web/src/routes/project.$id.tsx`:
  - Added `maxLength={50}` attribute to project name input in settings dialog
  - Added character counter below project name input that appears when length >= 40 characters
  - Counter shows "X/50 characters" format, turns red (destructive) at 50 characters
  - Added `maxLength={50}` attribute to track name inline edit input
  - Added character counter next to track name input that appears when length >= 40 characters
  - Track name counter is compact ("X/50" format) due to limited inline space
  - Counter turns red (destructive) at 50 characters limit

### Notes for Next Developer
- Character counters only appear when user is within 10 characters of the limit (>= 40 chars)
- This avoids visual clutter for normal-length names while providing feedback when needed
- The `maxLength` attribute on inputs enforces the limit at browser level (prevents typing beyond 50)
- Project name counter uses full format ("X/50 characters") since there's more space in the dialog
- Track name counter uses compact format ("X/50") since the inline editing area is constrained
- Color changes from muted to destructive at exactly 50 to signal "limit reached"

## 2026-01-27: Timeline Hover States

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Add hover states to timeline** - Show time position on mouse hover

### Changes Made
- Modified `apps/web/src/routes/project.$id.tsx`:
  - Added `hoverX` and `hoverTime` state to track cursor position on timeline
  - Added `handleMouseMove` callback to calculate cursor position and time from mouse events
  - Added `handleMouseLeave` callback to clear hover state when cursor leaves timeline
  - Draw hover indicator line: dashed vertical line with 40% opacity at cursor position
  - Added time tooltip that appears just below the ruler, showing time in `M:SS.ms` format
  - Tooltip auto-adjusts position when near right edge to stay within bounds
  - Canvas now listens to `onMouseMove` and `onMouseLeave` events

### Notes for Next Developer
- The hover line uses a dashed pattern (`ctx.setLineDash([4, 4])`) to differentiate from the solid playhead
- Time is displayed with centisecond precision (e.g., "1:23.45") for more precise seeking feedback
- The tooltip uses `pointer-events-none` to avoid interfering with canvas click events
- When hovering near the right edge (within 60px), tooltip shifts left to stay visible
- The hover indicator is drawn after the playhead so it appears on top
- `hoverX` is added to the canvas effect dependencies to trigger redraw on mouse move

## 2026-01-27: Drag-Drop Visual Feedback Improvements

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Improve drag-drop visual feedback** - Clearer drop zone indicators when reordering tracks

### Changes Made
- Modified `apps/web/src/routes/project.$id.tsx`:
  - Drop target indicator changed from thin 2px line to full highlighted background
  - Drop zone now shows `bg-primary/10` background with `ring-2 ring-inset ring-primary/50` border
  - Added `pointer-events-none` to drop indicator to avoid interfering with drag events
  - Added `rounded` for subtle border radius on drop target
  - Dragged item now has `scale-[0.98]` for subtle shrink effect
  - Dragged item has `shadow-lg` for visual lift/depth
  - Dragged item has `ring-2 ring-primary/30` for subtle highlight
  - Added `transition-all duration-150` for smooth animation on drag state changes

### Notes for Next Developer
- The drop indicator uses `inset-0` to fill the entire track row area, not just a thin line
- The `pointer-events-none` on the indicator prevents it from blocking drag events
- The dragged item retains `opacity-50` plus new shadow and scale effects
- Transition makes the drag state changes smooth rather than jarring
- Both "before" and "after" indicators use identical styling since they now highlight the whole row

## 2026-01-27: Timeline Zoom Controls

### Completed Tasks (from prd-ux-polish-improvements.md)
- **Improve zoom controls** - Add visible zoom in/out buttons alongside scroll-zoom

### Changes Made
- Modified `apps/web/src/routes/project.$id.tsx`:
  - Added `ZoomIn` and `ZoomOut` imports from lucide-react
  - Added `handleZoomIn` callback that multiplies pixelsPerSecond by 2 (clamped to max)
  - Added `handleZoomOut` callback that divides pixelsPerSecond by 2 (clamped to min)
  - Added `canZoomIn` and `canZoomOut` computed values to disable buttons at limits
  - Added zoom button controls in top-right corner of timeline (overlaying ruler area)
  - Buttons use `icon-xs` size and `ghost` variant for minimal visual footprint
  - Buttons have tooltips with 500ms delay showing "Zoom In" and "Zoom Out"
  - Buttons are disabled when at min/max zoom levels

### Notes for Next Developer
- The zoom buttons work alongside existing scroll-zoom (ctrl/cmd + wheel) and Safari gesture zoom
- Zoom factor is 2x per click, matching common behavior in DAWs
- Buttons are positioned in top-right of timeline area at `right-2 top-0.5`
- The PRD mentioned showing zoom level percentage - this was NOT implemented as it was listed as an open question
- Min zoom is 2 pixels/second, max is 200 pixels/second (unchanged from existing implementation)
