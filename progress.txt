## 2026-01-27: Convex Schema Implementation

Created the Convex schema with all three required tables:
- `projects`: id, name, createdAt, updatedAt
- `projectUsers`: id, projectId, userId, role ("owner" | "collaborator"), joinedAt
- `tracks`: id, projectId, name, order, muted, solo, gain, createdAt, updatedAt

Implemented all required mutations and queries:
- `projects.ts`: createProject, updateProject, deleteProject, getProject, getUserProjects
- `tracks.ts`: createTrack, updateTrack, deleteTrack, reorderTracks, getProjectTracks

Notes for next developer:
- The auth user object uses `_id` not `id` for the user identifier
- All functions include proper authorization checks (only owners/collaborators can access)
- Real-time subscriptions are supported via Convex's useQuery hook on the client
- deleteProject cascades to delete all tracks and projectUsers
- Indexes are set up for efficient queries by project and user

Next priority tasks:
1. Create packages/audio with Elementary Audio engine
2. Build project dashboard page (/)
3. Build DAW editor page (/project/:id)

## 2026-01-27: Audio Engine Package Implementation

Created `packages/audio` with Elementary Audio engine (web-renderer + core).

**Package structure:**
- `src/index.ts` - Main exports
- `src/engine.ts` - AudioEngine class
- `src/utils.ts` - dB/gain conversion utilities

**AudioEngine class implements all required functionality (FR-1 through FR-13):**
- `initialize()` - Creates AudioContext and initializes Elementary renderer
- `play()` / `stop()` - Transport controls, resumes suspended AudioContext
- `setPlayhead(seconds)` / `getPlayhead()` - Playhead position management
- `onPlayheadUpdate(callback)` - Subscribe to playhead updates (uses requestAnimationFrame)
- `setTracks(tracks[])` - Update track states (id, muted, solo, gain in dB)
- `setMasterGain(dB)` - Set master gain
- `dispose()` - Clean up resources

**Audio routing implemented:**
- Track signals → per-track gain → sum → master gain → stereo output
- Solo logic: when any track is soloed, only soloed tracks produce audio
- Gain range: -60dB to +12dB (complete silence below -60dB)
- Smooth gain transitions using el.sm() to avoid clicks
- Each track has keyed nodes for efficient Elementary Audio graph updates

**Notes for next developer:**
- In v1, tracks produce silence (no clips yet) but full routing works
- AudioEngine must be initialized after a user gesture (browser autoplay policy)
- Playhead position is local state (not synced to Convex)
- The package uses DOM lib (not node) for AudioContext types
- Pre-existing type errors in web app are unrelated (missing route generation)

Next priority tasks:
1. Build project dashboard page (/)
2. Build DAW editor page (/project/:id)
3. Implement timeline canvas with zoom/scroll

## 2026-01-27: Project Dashboard Implementation

Implemented the project dashboard page at "/" route (FR-20, FR-22, FR-23, FR-24, FR-25).

**Files created/modified:**
- `apps/web/src/routes/index.tsx` - Dashboard with project list and creation
- `apps/web/src/routes/project.$id.tsx` - Placeholder for DAW editor route

**Features implemented:**
- Authentication guards: Shows sign-in/sign-up for unauthenticated users (FR-22)
- Project list: Displays all user projects (owned and collaborated) in a grid (FR-23)
- "New Project" button: Creates project with "Untitled Project" name and navigates to editor (FR-24)
- Project cards: Show name, role (if collaborator), and last updated date with "Open" action (FR-25)
- Empty state: Helpful UI when user has no projects
- Loading states: Spinners while fetching data
- Toast notifications: Success/error feedback on project creation

**Notes for next developer:**
- The `/project/$id` route is a placeholder - DAW editor implementation is the next task
- Uses Convex `api.projects.getUserProjects` query with real-time subscriptions
- Uses Convex `api.projects.createProject` mutation
- TanStack Router generates `routeTree.gen.ts` during build (run `bun run build` if type errors about routes)
- Components used: Card, Button, Empty (Shadcn/UI), Lucide icons

Next priority tasks:
1. Build DAW editor page (/project/:id)
2. Implement timeline canvas with zoom/scroll
3. Implement track list with TanStack Virtual

## 2026-01-27: DAW Editor Page Implementation

Implemented the full DAW editor page at `/project/$id` route.

**File modified:**
- `apps/web/src/routes/project.$id.tsx` - Complete DAW editor implementation
- `apps/web/package.json` - Added `@el-audio-daw/audio` dependency

**Features implemented:**

1. **Authentication & Authorization (FR-21, FR-22)**
   - Auth guards using Authenticated/Unauthenticated/AuthLoading wrappers
   - Project access check via Convex query (returns null if no access)

2. **Audio Engine Integration (FR-28)**
   - "Start Audio" button shown before engine initialization (user gesture requirement)
   - Engine initialized on user click
   - Tracks synced to engine via useEffect when track state changes
   - Master gain synced to engine
   - Proper cleanup on unmount (engine.dispose())

3. **Layout (FR-26, FR-27)**
   - Header with back button, project name, and settings
   - Transport bar with play/stop buttons and clock display
   - Left panel (256px): Track headers with controls
   - Right panel: Timeline canvas with time ruler and playhead
   - Master track pinned at bottom of track list

4. **Timeline Canvas (FR-29-37)**
   - Canvas 2D rendering with devicePixelRatio support
   - Time ruler at top showing time markers (0:00, 0:30, etc.)
   - Marker interval adjusts with zoom level
   - Horizontal scroll via shift+scroll or horizontal trackpad
   - Zoom via ctrl/cmd+scroll (min: 2px/s, max: 200px/s)
   - Click to seek (sets playhead position)
   - Playhead line rendered at current time

5. **Track Controls (FR-39-46)**
   - Editable track name (click to edit, Enter/Escape/blur to save)
   - Mute button with yellow indicator when active (M / VolumeX icon)
   - Solo button with green indicator when active (S)
   - Gain slider (-60dB to +12dB) with dB display
   - Delete button on each track header

6. **Master Track (FR-47-49)**
   - Fixed at bottom of track list (not in scrollable area)
   - Label "Master" with gain slider and dB display
   - Gain range -60dB to +12dB

7. **Transport Controls (FR-50-55)**
   - Play button (toggles to Pause icon when playing)
   - Stop button
   - Clock display in M:SS.mmm format
   - Clock updates during playback via onPlayheadUpdate callback

8. **Project Settings Modal (FR-56-57)**
   - Settings button in header opens dialog
   - Project name input field
   - Save button updates project via Convex mutation

9. **Keyboard Shortcuts (FR-58-59)**
   - Spacebar: toggle play/stop (ignored when focus in input)
   - Cmd+T / Ctrl+T: add new track

10. **Real-time Sync (FR-60, FR-19)**
    - Track state (name, muted, solo, gain) stored in Convex
    - useQuery for real-time track list subscription
    - useMutation for track updates
    - Changes visible to all collaborators immediately

**Notes for next developer:**
- Track virtualization (TanStack Virtual) is NOT yet implemented - tracks render normally
- Track reordering (drag-and-drop) is NOT yet implemented
- The Slider component uses base-ui with onValueChange that returns either number or number[]
- The Toggle component uses base-ui with `pressed` prop (not `checked`)
- DialogTrigger uses `render` prop instead of `asChild` (base-ui pattern)
- Canvas uses CSS custom properties for colors (--background, --border, --muted-foreground)

**Remaining tasks:**
1. Implement track virtualization with TanStack Virtual (for 50+ tracks performance)
2. Implement track reordering via drag-and-drop

## 2026-01-27: Track List Virtualization with TanStack Virtual

Implemented virtualized track list using `@tanstack/react-virtual` (FR-38).

**Files modified:**
- `apps/web/src/routes/project.$id.tsx` - Added VirtualizedTrackList component
- `apps/web/package.json` - Added `@tanstack/react-virtual` dependency

**Implementation details:**

1. **VirtualizedTrackList component**
   - Uses `useVirtualizer` from TanStack Virtual
   - Fixed track header height of 60px (TRACK_HEADER_HEIGHT constant)
   - Overscan of 5 items for smooth scrolling
   - Absolute positioning with transforms for virtual items
   - Synced scroll position with timeline canvas via shared `scrollTop` state

2. **Synchronized vertical scrolling (FR-27)**
   - Added `scrollTop` state to parent `ProjectEditor` component
   - Both track list and timeline canvas share the same scroll offset
   - Vertical scroll on timeline canvas syncs to track headers
   - Vertical scroll on track headers syncs to timeline canvas
   - Track lanes on canvas now render with scroll offset

3. **TrackHeader component updates**
   - Fixed height of 60px with `box-border` to include padding/borders
   - Adjusted spacing to fit within fixed height

**Notes for next developer:**
- The virtualizer uses `estimateSize: () => TRACK_HEADER_HEIGHT` with fixed 60px height
- Scroll sync works bidirectionally between track list and timeline
- The timeline canvas uses wheel events for vertical scroll when no modifiers pressed
- Only visible tracks are rendered, enabling smooth performance with 50+ tracks

**Remaining task:**
1. Implement track reordering via drag-and-drop (FR-45)
